<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eternal Care Elite | System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        :root { --main: #00b894; --sidebar: #0f1423; --bg: #f8f9fc; }
        body { margin: 0; font-family: 'Inter', sans-serif; display: flex; height: 100vh; background: var(--bg); color: #333; }
        
        .sidebar { width: 260px; background: var(--sidebar); color: white; display: flex; flex-direction: column; padding: 20px 0; }
        .sidebar-brand { padding: 0 25px 30px; font-size: 24px; font-weight: 900; color: var(--main); }
        .sidebar-item { padding: 15px 25px; cursor: pointer; display: flex; align-items: center; gap: 15px; color: #a4b0be; transition: 0.3s; }
        .sidebar-item:hover, .active { background: rgba(0,184,148,0.15); color: var(--main); border-right: 4px solid var(--main); }

        .content { flex: 1; padding: 30px; overflow-y: auto; }
        .card { background: white; border-radius: 16px; padding: 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.03); margin-bottom: 25px; }
        
        /* FEATURE 3: PACKAGE STYLE */
        .package-container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px; }
        .package-card { border: 2px solid #eee; border-radius: 12px; padding: 15px; text-align: center; cursor: pointer; transition: 0.3s; }
        .package-card:hover, .package-selected { border-color: var(--main); background: #f0fffb; }
        .package-card h4 { margin: 10px 0; color: var(--sidebar); }
        .package-price { font-weight: 900; color: var(--main); font-size: 1.2rem; }

        /* FEATURE 5: MAP STYLE */
        #map { height: 250px; border-radius: 12px; margin-top: 10px; border: 2px solid #eee; }

        /* ANALYTICS GRID */
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 25px; }
        .stat-box { background: white; padding: 20px; border-radius: 12px; border-bottom: 4px solid var(--main); }
        .stat-val { font-size: 24px; font-weight: 900; display: block; }
        .stat-label { font-size: 12px; color: #888; text-transform: uppercase; }

        .form-group { margin-bottom: 15px; }
        label { display: block; font-size: 11px; font-weight: 800; color: #666; margin-bottom: 5px; text-transform: uppercase; }
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; }
        
        .btn-main { background: var(--main); color: white; border: none; padding: 15px; border-radius: 10px; font-weight: bold; cursor: pointer; width: 100%; transition: 0.3s; }
        .btn-main:hover { background: #009476; transform: translateY(-2px); }

        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 15px; color: #888; font-size: 12px; border-bottom: 2px solid #f4f4f4; }
        td { padding: 15px; border-bottom: 1px solid #eee; font-size: 14px; }

        
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="sidebar-brand">SELLIO <span style="color:white; font-size: 12px;">PRO</span></div>
        <div class="sidebar-item active" id="nav-dash" onclick="location.reload()"><i class="fas fa-chart-pie"></i><span>Dashboard</span></div>
        <div class="sidebar-item" onclick="logout()" style="margin-top: auto;"><i class="fas fa-power-off"></i><span>Logout</span></div>
    </div>

    <div class="content">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
            <h1 id="view-title">Funeral Hub</h1>
            <div id="user-tag" style="background: white; padding: 10px 20px; border-radius: 30px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); font-weight: bold; font-size: 14px;"></div>
        </div>

        <div id="user-view" style="display:none;">
            <div style="display: grid; grid-template-columns: 1.5fr 1fr; gap: 25px;">
                <div>
                    <div class="card">
                        <div style="font-weight: 900; margin-bottom: 20px;"><i class="fas fa-layer-group"></i> FEATURE 3: SELECT PACKAGE</div>
                        <div class="package-container">
                            <div class="package-card" onclick="selectPkg('Bronze', 25000, this)">
                                <i class="fas fa-medal" style="color:#cd7f32"></i>
                                <h4>BRONZE</h4>
                                <span class="package-price">₱25k</span>
                                <p style="font-size: 10px;">Wood Coffin + Basic Karo</p>
                            </div>
                            <div class="package-card" onclick="selectPkg('Gold', 55000, this)">
                                <i class="fas fa-medal" style="color:#facc15"></i>
                                <h4>GOLD</h4>
                                <span class="package-price">₱55k</span>
                                <p style="font-size: 10px;">Metal Coffin + Modern Hearse</p>
                            </div>
                            <div class="package-card" onclick="selectPkg('Elite', 120000, this)">
                                <i class="fas fa-crown" style="color:#00b894"></i>
                                <h4>ELITE</h4>
                                <span class="package-price">₱120k</span>
                                <p style="font-size: 10px;">Premium Marble + Limousine</p>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Full Name of Deceased</label>
                            <input type="text" id="reg-name" placeholder="Enter name...">
                        </div>
                    </div>

                    <div class="card">
                        <div style="font-weight: 900; margin-bottom: 15px;"><i class="fas fa-map-marker-alt"></i> FEATURE 5: PIN LOCATION</div>
                        <p style="font-size: 12px; color: #666;">Drag the map to pinpoint the exact location for the service.</p>
                        <div id="map"></div>
                        <input type="hidden" id="reg-coords">
                    </div>
                </div>

                <div class="card">
                    <div style="font-weight: 900; margin-bottom: 20px;">Order Summary</div>
                    <div class="form-group"><label>Attire Customization</label><select id="reg-attire"><option>Barong Tagalog</option><option>White Gown</option></select></div>
                    <div class="form-group"><label>Payment Method</label><select id="reg-pay"><option>G-Cash (0912-345-6789)</option><option>Bank Transfer</option></select></div>
                    <div id="summary-box" style="background: #f8f9fc; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                        <div style="display:flex; justify-content: space-between;"><span>Package:</span> <b id="sum-pkg">-</b></div>
                        <div style="display:flex; justify-content: space-between; margin-top: 10px;"><span>Total:</span> <b id="sum-price" style="color:var(--main)">₱0</b></div>
                    </div>
                    <button class="btn-main" onclick="processOrder()">PLACE BOOKING</button>
                </div>
            </div>
        </div>

        <div id="admin-view" style="display:none;">
            <div class="stats-grid">
                <div class="stat-box"><span class="stat-label">Total Bookings</span><span id="stat-total" class="stat-val">0</span></div>
                <div class="stat-box"><span class="stat-label">Bronze Sales</span><span id="stat-bronze" class="stat-val">0</span></div>
                <div class="stat-box"><span class="stat-label">Gold Sales</span><span id="stat-gold" class="stat-val">0</span></div>
                <div class="stat-box"><span class="stat-label">Elite Sales</span><span id="stat-elite" class="stat-val">0</span></div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1.5fr; gap: 20px;">
                <div class="card">
                    <div style="font-weight: 900; margin-bottom: 20px;">Sales Distribution</div>
                    <canvas id="salesChart" height="250"></canvas>
                </div>
                <div class="card">
                    <div style="font-weight: 900; margin-bottom: 20px;">Recent Registrations</div>
                    <div style="overflow-x: auto;">
                        <table>
                            <thead><tr><th>Deceased</th><th>Package</th><th>Payment</th><th>Actions</th></tr></thead>
                            <tbody id="admin-list"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const session = JSON.parse(localStorage.getItem('loginSession'));
        let selectedPackage = { name: '', price: 0 };
        let map, marker;

        window.onload = function() {
            if(!session) window.location.href = 'index.html';
            document.getElementById('user-tag').innerText = session.name;

            if(session.role === 'admin') {
                document.getElementById('admin-view').style.display = 'block';
                updateAnalytics();
                renderSalesChart();
            } else {
                document.getElementById('user-view').style.display = 'block';
                initMap();
            }
        };

        // --- FEATURE 3: PACKAGE LOGIC ---
        function selectPkg(name, price, el) {
            selectedPackage = { name, price };
            document.querySelectorAll('.package-card').forEach(c => c.classList.remove('package-selected'));
            el.classList.add('package-selected');
            document.getElementById('sum-pkg').innerText = name;
            document.getElementById('sum-price').innerText = '₱' + price.toLocaleString();
        }

        // --- FEATURE 5: MAP LOGIC (Leaflet) ---
        function initMap() {
            // Default center: Manila/Philippines area
            map = L.map('map').setView([14.5995, 120.9842], 13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            marker = L.marker([14.5995, 120.9842], {draggable: true}).addTo(map);
            
            marker.on('dragend', function() {
                const pos = marker.getLatLng();
                document.getElementById('reg-coords').value = `${pos.lat},${pos.lng}`;
            });
        }

        function processOrder() {
            const name = document.getElementById('reg-name').value;
            if(!name || !selectedPackage.name) return alert("Please fill name and select a package");

            const order = {
                id: Date.now(),
                deceased: name,
                pkg: selectedPackage.name,
                price: selectedPackage.price,
                pay: document.getElementById('reg-pay').value,
                coords: document.getElementById('reg-coords').value || "14.59, 120.98",
                date: new Date().toLocaleDateString()
            };

            let data = JSON.parse(localStorage.getItem('funeral_pro_data')) || [];
            data.push(order);
            localStorage.setItem('funeral_pro_data', JSON.stringify(data));
            alert("Order Confirmed! Admin will contact you shortly.");
            location.reload();
        }

        // --- FEATURE 4: ADMIN ANALYTICS ---
        function updateAnalytics() {
            const data = JSON.parse(localStorage.getItem('funeral_pro_data')) || [];
            document.getElementById('stat-total').innerText = data.length;
            document.getElementById('stat-bronze').innerText = data.filter(i => i.pkg === 'Bronze').length;
            document.getElementById('stat-gold').innerText = data.filter(i => i.pkg === 'Gold').length;
            document.getElementById('stat-elite').innerText = data.filter(i => i.pkg === 'Elite').length;

            const list = document.getElementById('admin-list');
            list.innerHTML = data.map(i => `
                <tr>
                    <td><b>${i.deceased}</b></td>
                    <td><small>${i.pkg}</small></td>
                    <td><span style="color:var(--main); font-weight:bold">${i.pay}</span></td>
                    <td><button onclick="deleteEntry(${i.id})" style="border:none; color:red; cursor:pointer;"><i class="fas fa-trash"></i></button></td>
                </tr>
            `).join('');
        }

        function renderSalesChart() {
            const data = JSON.parse(localStorage.getItem('funeral_pro_data')) || [];
            const counts = { Bronze: 0, Gold: 0, Elite: 0 };
            data.forEach(i => counts[i.pkg]++);

            const ctx = document.getElementById('salesChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Bronze', 'Gold', 'Elite'],
                    datasets: [{
                        data: [counts.Bronze, counts.Gold, counts.Elite],
                        backgroundColor: ['#cd7f32', '#facc15', '#00b894'],
                        borderWidth: 0
                    }]
                },
                options: { maintainAspectRatio: false }
            });
        }

        function deleteEntry(id) {
            if(!confirm("Delete this record?")) return;
            let data = JSON.parse(localStorage.getItem('funeral_pro_data')) || [];
            data = data.filter(i => i.id !== id);
            localStorage.setItem('funeral_pro_data', JSON.stringify(data));
            location.reload();
        }

        function logout() {
            localStorage.removeItem('loginSession');
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>
